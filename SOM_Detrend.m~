% - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%
% Robert C. Welsh
% Copyright 2011
%
% Ann Arbor, MI
%
%
% newData = SOM_Detrend(data,polyorder);
%
%
% Input Parameters that we need for preparing the data
%
% polyorder = order of the polynomial, 0 is mean centered.
%
% data      = data (space x time);
%
% This we operate on the 2nd dimension.
%
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

function results = SOM_Detrend(data,polyorder)

% Check to see if they specified the polynomial order.

if nargin == 1
  polyorder = 0;
end

% 
% If polyorder = 0 then we are just mean centering the data.
%

if polyorder == 0
  results = bsxfun(@minus,data,mean(data,2));
  return
end

% 
% Okay the specified something
%

X = zeros(size(data,2),