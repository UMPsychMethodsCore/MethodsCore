
% - - - - - - - START OF PART II - - - - - - - - - - - - - - - 

% Deblank just in case.

UMBatchMaster = deblank(UMBatchMaster);

% If all of the subjects are in the same organization scheme
% then you should not have to modify this piece of code from this point 
% forward.

fprintf('\nWarping images using UMBatchVBM8\n');

fprintf('Looping on the subjects now\n\n');

%
% Loop over the subjects and coregister each one.
%

for iSub = 1:length(UMBatchSubjs)
    %
    fprintf('Working on %s\n',UMBatchSubjs{iSub});
    %
    % Break into two steps, one to calculate the normalization for the
    % SPGR.
    %
    ParamImage = UMImg2Warp{iSub};
    %
    % Make sure the image exists.
    %
    if exist(ParamImage) == 2
      UMBatchWarp(ParamImage,[],Img2Write,UMTestFlag,VoxelSize,OutputName);
    else
      fprintf('FATAL ERROR : Image to warp does not exist: %s\n',ParamImage)
      exit
    end
end

fprintf('\nAll done with warping of High Resolution images to template\n');

%
% All done.
%
