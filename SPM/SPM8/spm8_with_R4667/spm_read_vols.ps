%!PS-Adobe-2.0
%%Title: text.ps
%%Pages: (atend)
%%Creator: Robert Welsh Program Lister v0.1
%%CreationDate: TODAY
%%EndComments
/line {10 mul} def
/inch {72 mul} def
/tf {/Courier findfont 10 scalefont setfont} def
/hf {/Helvetica findfont 10 scalefont setfont} def
/hfb {/Helvetica-Bold findfont 10 scalefont setfont} def
/cf {/Courier findfont 10 scalefont setfont} def
hf 0 0 moveto
(File : ) stringwidth /dfy exch def /dfx exch def
(Date : ) stringwidth /ddy exch def /ddx exch def
(Page : ) stringwidth /dpy exch def /dpx exch def
cf (M) stringwidth /mHeight exch def /mWidth exch def
/greyBoxHeight {4 line} def
/s { show } def 
/nl { grestore 0 -1 line rmoveto gsave } def 
/LandDict 20 dict def
LandDict begin
 /tranX 612 def
 /tranY 0 def
 /rotAng 90 def
 /pageWidth 792 def
 /pageHeight 612 def
 /topLeft {0 612 moveto} def
 /topRight {792 612 moveto} def
 /greyBoxWidth 115 mWidth mul def
 /nBoxes 7 def
end
/indent {50 0 rmoveto} def
/PortDict 20 dict def
PortDict begin
 /tranX 0 def
 /tranY 0 def
 /rotAng 0 def
 /pageWidth 612 def
 /pageHeight 792 def
 /topLeft {0 792 moveto} def
 /topRight {612 792 moveto} def
 /greyBoxWidth 115 mWidth mul def
 /nBoxes 10 def
end
/greyBox { 
 greyBoxWidth 0 rlineto
 0 greyBoxHeight neg rlineto
 greyBoxWidth neg 0 rlineto
 0 greyBoxHeight rlineto
 closepath
 fill
} def
/greyBack {
 gsave
 /DeviceGray setcolorspace 0.975 setcolor /boxOffset 52 def
 nBoxes {
  18 pageHeight boxOffset sub moveto greyBox
  /boxOffset  boxOffset 8 line add def } repeat
 grestore
} def
/pageHeader {
 hf topLeft
 gsave
 18 -21 rmoveto
 (File :) show
 grestore
 18 -36 rmoveto
 (Date :) show
 topRight
 -108 -21 rmoveto
 (Page :) show
} def
/pageLines{
 gsave
 /DeviceGray setcolorspace
 0.75 setcolor
 newpath topLeft indent
 0 -52 rmoveto
 mWidth 72.2 mul 0 rmoveto
 0 0 nBoxes 2 mul 1 sub 4 mul line sub rlineto 
 closepath 0.5 setlinewidth
 stroke
 newpath topLeft indent
 0 -52 rmoveto
 mWidth 6.2 mul 0 rmoveto
 0 0 nBoxes 2 mul 1 sub 4 mul line sub rlineto 
 closepath 0.5 setlinewidth
 stroke
 grestore
} def
%%EndProlog
%%Page: number 1
gsave
LandDict begin
tranX tranY translate
rotAng rotate
 36 36 translate 0.9 0.9 scale
greyBack
pageHeader
tf topLeft gsave
18 dfx add -21 rmoveto
 ( spm_read_vols.m ) show
grestore
18 ddx add -36 rmoveto
 ( Wed Jul 27 19:36:29 2011
 ) show
topRight
 -108 dpx add -21 rmoveto
 ( 1 ) show
cf topLeft indent 0 -60 rmoveto gsave
(    1 ) stringwidth exch neg exch rmoveto 
(    1 ) show grestore gsave 
(function [Y,XYZ] = spm_read_vols\(V,mask\)) s nl 
(    2 ) stringwidth exch neg exch rmoveto 
(    2 ) show grestore gsave 
(% Read in entire image volumes) s nl 
(    3 ) stringwidth exch neg exch rmoveto 
(    3 ) show grestore gsave 
(% FORMAT [Y,XYZ] = spm_read_vols\(V,mask\)) s nl 
(    4 ) stringwidth exch neg exch rmoveto 
(    4 ) show grestore gsave 
(% V    - vector of mapped image volumes to read in \(from spm_vol\)) s nl 
(    5 ) stringwidth exch neg exch rmoveto 
(    5 ) show grestore gsave 
(% mask - implicit zero mask?) s nl 
(    6 ) stringwidth exch neg exch rmoveto 
(    6 ) show grestore gsave 
(%) s nl 
(    7 ) stringwidth exch neg exch rmoveto 
(    7 ) show grestore gsave 
(% Y    - 4D matrix of image data, fourth dimension indexes images) s nl 
(    8 ) stringwidth exch neg exch rmoveto 
(    8 ) show grestore gsave 
(% XYZ  - 3xn matrix of XYZ locations returned \(in mm\)) s nl 
(    9 ) stringwidth exch neg exch rmoveto 
(    9 ) show grestore gsave 
(%__________________________________________________________________________) s nl 
(   10 ) stringwidth exch neg exch rmoveto 
(   10 ) show grestore gsave 
(%) s nl 
(   11 ) stringwidth exch neg exch rmoveto 
(   11 ) show grestore gsave 
(% For image data types without a representation of NaN \(see spm_type\),) s nl 
(   12 ) stringwidth exch neg exch rmoveto 
(   12 ) show grestore gsave 
(% implicit zero masking can be used. If mask is set, then zeros are) s nl 
(   13 ) stringwidth exch neg exch rmoveto 
(   13 ) show grestore gsave 
(% treated as masked, and returned as NaN.) s nl 
(   14 ) stringwidth exch neg exch rmoveto 
(   14 ) show grestore gsave 
(%__________________________________________________________________________) s nl 
(   15 ) stringwidth exch neg exch rmoveto 
(   15 ) show grestore gsave 
(% Copyright \(C\) 2008 Wellcome Trust Centre for Neuroimaging) s nl 
(   16 ) stringwidth exch neg exch rmoveto 
(   16 ) show grestore gsave 
() s nl 
(   17 ) stringwidth exch neg exch rmoveto 
(   17 ) show grestore gsave 
(% Andrew Holmes) s nl 
(   18 ) stringwidth exch neg exch rmoveto 
(   18 ) show grestore gsave 
(% $Id: spm_read_vols.m 3663 2010-01-07 12:26:48Z guillaume $) s nl 
(   19 ) stringwidth exch neg exch rmoveto 
(   19 ) show grestore gsave 
() s nl 
(   20 ) stringwidth exch neg exch rmoveto 
(   20 ) show grestore gsave 
() s nl 
(   21 ) stringwidth exch neg exch rmoveto 
(   21 ) show grestore gsave 
(%-Argument checks) s nl 
(   22 ) stringwidth exch neg exch rmoveto 
(   22 ) show grestore gsave 
(%--------------------------------------------------------------------------) s nl 
(   23 ) stringwidth exch neg exch rmoveto 
(   23 ) show grestore gsave 
(if nargin<2, mask = 0; end) s nl 
(   24 ) stringwidth exch neg exch rmoveto 
(   24 ) show grestore gsave 
(if nargin<1, error\('insufficient arguments'\), end) s nl 
(   25 ) stringwidth exch neg exch rmoveto 
(   25 ) show grestore gsave 
() s nl 
(   26 ) stringwidth exch neg exch rmoveto 
(   26 ) show grestore gsave 
(spm_check_orientations\(V\);) s nl 
(   27 ) stringwidth exch neg exch rmoveto 
(   27 ) show grestore gsave 
() s nl 
(   28 ) stringwidth exch neg exch rmoveto 
(   28 ) show grestore gsave 
(%-Read in image data) s nl 
(   29 ) stringwidth exch neg exch rmoveto 
(   29 ) show grestore gsave 
(%--------------------------------------------------------------------------) s nl 
(   30 ) stringwidth exch neg exch rmoveto 
(   30 ) show grestore gsave 
(n = numel\(V\);                       %-#images) s nl 
(   31 ) stringwidth exch neg exch rmoveto 
(   31 ) show grestore gsave 
(Y = zeros\([V\(1\).dim\(1:3\),n]\);       %-image data matrix) s nl 
(   32 ) stringwidth exch neg exch rmoveto 
(   32 ) show grestore gsave 
() s nl 
(   33 ) stringwidth exch neg exch rmoveto 
(   33 ) show grestore gsave 
(for i=1:n, for p=1:V\(1\).dim\(3\)) s nl 
(   34 ) stringwidth exch neg exch rmoveto 
(   34 ) show grestore gsave 
(    Y\(:,:,p,i\) = spm_slice_vol\(V\(i\),spm_matrix\([0 0 p]\),V\(i\).dim\(1:2\),0\);) s nl 
(   35 ) stringwidth exch neg exch rmoveto 
(   35 ) show grestore gsave 
(end, end) s nl 
(   36 ) stringwidth exch neg exch rmoveto 
(   36 ) show grestore gsave 
() s nl 
(   37 ) stringwidth exch neg exch rmoveto 
(   37 ) show grestore gsave 
(%-Apply implicit zero mask for image datatypes without a NaNrep) s nl 
(   38 ) stringwidth exch neg exch rmoveto 
(   38 ) show grestore gsave 
(%--------------------------------------------------------------------------) s nl 
(   39 ) stringwidth exch neg exch rmoveto 
(   39 ) show grestore gsave 
(if mask) s nl 
(   40 ) stringwidth exch neg exch rmoveto 
(   40 ) show grestore gsave 
(    %-Work out images without NaNrep) s nl 
(   41 ) stringwidth exch neg exch rmoveto 
(   41 ) show grestore gsave 
(    im = false\(n,1\);) s nl 
(   42 ) stringwidth exch neg exch rmoveto 
(   42 ) show grestore gsave 
(    for i=1:n, im\(i\)=~spm_type\(V\(i\).dt\(1\),'NaNrep'\); end) s nl 
(   43 ) stringwidth exch neg exch rmoveto 
(   43 ) show grestore gsave 
(    %-Mask) s nl 
(   44 ) stringwidth exch neg exch rmoveto 
(   44 ) show grestore gsave 
(    Y\(Y\(:,:,:,im\)==0\) = NaN;) s nl 
(   45 ) stringwidth exch neg exch rmoveto 
(   45 ) show grestore gsave 
(end) s nl 
(   46 ) stringwidth exch neg exch rmoveto 
(   46 ) show grestore gsave 
() s nl 
(   47 ) stringwidth exch neg exch rmoveto 
(   47 ) show grestore gsave 
(%-Return as 3D matrix if single image) s nl 
(   48 ) stringwidth exch neg exch rmoveto 
(   48 ) show grestore gsave 
(%--------------------------------------------------------------------------) s nl 
(   49 ) stringwidth exch neg exch rmoveto 
(   49 ) show grestore gsave 
(if n==1, Y=Y\(:,:,:,1\); end) s nl 
(   50 ) stringwidth exch neg exch rmoveto 
(   50 ) show grestore gsave 
() s nl 
(   51 ) stringwidth exch neg exch rmoveto 
(   51 ) show grestore gsave 
(%-Compute XYZ co-ordinates \(if required\)) s nl 
(   52 ) stringwidth exch neg exch rmoveto 
(   52 ) show grestore gsave 
(%--------------------------------------------------------------------------) s nl 
end showpage grestore grestore 
%%PageTrailer 
%%Page: number 2
gsave
LandDict begin
tranX tranY translate
rotAng rotate
 36 36 translate 0.9 0.9 scale
greyBack
pageHeader
tf topLeft gsave
18 dfx add -21 rmoveto
 ( spm_read_vols.m ) show
grestore
18 ddx add -36 rmoveto
 ( Wed Jul 27 19:36:29 2011
 ) show
topRight
 -108 dpx add -21 rmoveto
 ( 2 ) show
cf topLeft indent 0 -60 rmoveto gsave
(   53 ) stringwidth exch neg exch rmoveto 
(   53 ) show grestore gsave 
(if nargout>1) s nl 
(   54 ) stringwidth exch neg exch rmoveto 
(   54 ) show grestore gsave 
(    [R,C,P]  = ndgrid\(1:V\(1\).dim\(1\),1:V\(1\).dim\(2\),1:V\(1\).dim\(3\)\);) s nl 
(   55 ) stringwidth exch neg exch rmoveto 
(   55 ) show grestore gsave 
(    RCP      = [R\(:\)';C\(:\)';P\(:\)'];) s nl 
(   56 ) stringwidth exch neg exch rmoveto 
(   56 ) show grestore gsave 
(    clear R C P) s nl 
(   57 ) stringwidth exch neg exch rmoveto 
(   57 ) show grestore gsave 
(    RCP\(4,:\) = 1;) s nl 
(   58 ) stringwidth exch neg exch rmoveto 
(   58 ) show grestore gsave 
(    XYZ      = V\(1\).mat\(1:3,:\)*RCP;) s nl 
(   59 ) stringwidth exch neg exch rmoveto 
(   59 ) show grestore gsave 
(end) s nl 
end showpage grestore grestore 
%%PageTrailer 
%%Trailer 
%%Pages: 2
%%EOF 
